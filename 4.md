# 数据治理 DeepDive Week 4：架构分层 —— 异步队列与高可用

## 🔄 承接上周

现在我们的系统很灵活，但有一个致命问题：**同步阻塞**。当用户上传一个大文件时，前端页面一直在转圈等待，直到后端处理完（可能几分钟）。这用户体验太差了，而且容易超时。
本周任务：**引入消息队列**，将“接收文件”和“处理文件”彻底解耦。

## 🎯 深度目标

1.  **异步处理**：
    - API 接口只负责接收文件 -> 生成任务 ID -> 返回“处理中” -> 结束请求。
    - 后台启动 Worker 线程（或独立进程）监听队列，慢慢处理文件。
2.  **中间件集成**：引入 **Redis** 或 **RabbitMQ** 作为任务队列。
3.  **进度反馈**：实现一个接口 `/check-status?taskId=xxx`，返回当前处理进度（例如：`Progress: 45%`）。

## 📦 业务场景升级

- **用户体验**：用户上传 1GB 文件，秒级返回“上传成功，任务 ID：1001”，随后用户可以在列表页看到进度条在跑。
- **高可用**：模拟处理到一半时强制杀掉 Worker 进程，重启后，系统是否能检测到失败的任务并重试？（选做）

## 🤖 AI 提效挑战（必做）

### 1. 架构改造（生产者-消费者）

- **挑战**：利用 AI 生成队列代码。
- **Prompt 示例**：
  > "我需要将同步的文件处理改为异步。请帮我设计一个基于 Redis List 的生产者-消费者模型。Web 接口（生产者）将文件路径推入 Redis，Worker（消费者）从 Redis 取出路径进行处理，并在 Redis 中实时更新处理进度。"

### 2. 进度条逻辑

- **挑战**：前后端配合。
- **Prompt 示例**：
  > "前端如何实现一个实时的进度条？请给出方案。方案 A：轮询（Polling）；方案 B：WebSocket。请分别给出简单的代码示例，并分析优缺点。"

## 📅 验收标准

1.  **体验**：上传大文件后页面不卡死，立即显示进度条。
2.  **基建**：必须在项目中运行起 Redis 或 MQ 服务。
