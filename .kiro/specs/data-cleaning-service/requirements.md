# 需求文档

## 介绍

数据清洗服务是一个基于NestJS的后端服务，用于处理Excel文件中的脏数据。系统能够自动清洗和标准化手机号、日期、地址等数据，并提供清洗后的数据导出功能。

## 术语表

- **System**: 数据清洗服务系统
- **User**: 使用系统的用户
- **Excel_File**: 用户上传的Excel文件
- **Clean_Data**: 符合规范的已处理数据
- **Exception_Data**: 无法处理的异常数据行
- **Phone_Number**: 手机号码字段
- **Date_Field**: 日期字段
- **Address_Field**: 地址字段

## 需求

### 需求 1

**用户故事：** 作为用户，我想要上传Excel文件，以便系统能够处理其中的脏数据。

#### 验收标准

1. 当用户上传Excel文件时，系统应当接受并存储该文件
2. 当用户上传非Excel格式文件时，系统应当拒绝上传并返回错误信息
3. 当上传的Excel文件超过大小限制时，系统应当拒绝上传并返回相应提示
4. 当Excel文件上传成功时，系统应当返回文件标识符供后续处理使用

### 需求 2

**用户故事：** 作为用户，我想要系统读取Excel文件内容，以便进行数据清洗处理。

#### 验收标准

1. 当系统读取Excel文件时，应当正确解析所有工作表数据
2. 当Excel文件包含多个工作表时，系统应当处理所有工作表
3. 当Excel文件为空或损坏时，系统应当返回相应错误信息
4. 当读取完成时，系统应当识别出手机号、日期、地址等字段类型

### 需求 3

**用户故事：** 作为用户，我想要系统清洗手机号数据，以便获得标准格式的手机号。

#### 验收标准

1. 当手机号包含空格时，系统应当移除所有空格字符
2. 当手机号包含横杠时，系统应当移除所有横杠字符
3. 当手机号包含其他非数字字符时，系统应当移除这些字符只保留纯数字
4. 当处理后的手机号不符合有效长度时，系统应当将该行标记为异常数据
5. 当手机号为空或null时，系统应当将该行标记为异常数据

### 需求 4

**用户故事：** 作为用户，我想要系统标准化日期格式，以便获得统一的日期表示。

#### 验收标准

1. 当日期为各种格式时，系统应当将其转换为YYYY-MM-DD格式
2. 当日期包含中文字符时，系统应当正确解析并转换格式
3. 当日期格式无法识别时，系统应当将该行标记为异常数据
4. 当日期为空或null时，系统应当将该行标记为异常数据
5. 当日期超出合理范围时，系统应当将该行标记为异常数据

### 需求 5

**用户故事：** 作为用户，我想要系统从地址文本中提取省市区信息，以便获得结构化的地址数据。

#### 验收标准

1. 当地址包含完整的省市区信息时，系统应当正确提取并分别存储
2. 当地址文本较长时，系统应当从中识别出省市区关键信息
3. 当地址信息不完整或无法识别时，系统应当将该行标记为异常数据
4. 当地址为空或null时，系统应当将该行标记为异常数据
5. 当提取完成时，系统应当返回省、市、区三个独立字段

### 需求 6

**用户故事：** 作为用户，我想要导出处理后的清洁数据，以便使用标准化的数据。

#### 验收标准

1. 当数据处理完成时，系统应当提供清洁数据的Excel导出功能
2. 当导出清洁数据时，系统应当保持原有的数据结构和字段顺序
3. 当导出文件生成时，系统应当返回下载链接或文件流
4. 当没有清洁数据时，系统应当返回相应提示信息

### 需求 7

**用户故事：** 作为用户，我想要单独导出异常数据，以便手动处理无法自动清洗的数据。

#### 验收标准

1. 当存在异常数据时，系统应当提供异常数据的Excel导出功能
2. 当导出异常数据时，系统应当包含原始数据和异常原因说明
3. 当导出异常文件时，系统应当标明哪些字段存在问题
4. 当没有异常数据时，系统应当返回相应提示信息

### 需求 8

**用户故事：** 作为用户，我想要查询所有上传的文件记录，以便查看历史处理记录和文件状态。

#### 验收标准

1. 当用户请求文件列表时，系统应当返回所有文件记录的分页列表
2. 当查询文件列表时，系统应当支持按状态、日期范围进行筛选
3. 当返回文件记录时，系统应当包含文件名称、文件大小、文件类型、上传时间、处理完成时间、文件ID等信息
4. 当用户查询单个文件详情时，系统应当返回完整的文件信息和处理统计数据

### 需求 9

**用户故事：** 作为系统管理员，我想要系统提供处理状态和统计信息，以便监控数据处理效果。

#### 验收标准

1. 当数据处理进行时，系统应当提供实时的处理进度信息
2. 当处理完成时，系统应当返回处理统计报告
3. 当统计报告生成时，系统应当包含总行数、成功处理行数、异常行数等信息
4. 当用户查询处理状态时，系统应当返回当前处理阶段和进度百分比