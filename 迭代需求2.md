# 数据治理 DeepDive Week 3：拒绝硬编码 —— 动态规则引擎

## 🔄 承接上周

上周我们将数据存入了数据库。但现在的清洗规则（如“手机号必须 11 位”）是**写死在代码里**的。如果明天业务方说“我们要清洗新加坡手机号（8 位数）”，你就得改代码、重新打包、重新部署。
本周任务：**剥离规则**，实现一个支持热插拔配置的清洗引擎。

## 🎯 深度目标

1.  **规则配置化**：设计一种 JSON 结构来描述规则，例如 `{"column": "phone", "type": "regex", "pattern": "^1\\d{10}$"}`。
2.  **设计模式应用**：使用 **策略模式 (Strategy Pattern)** 或 **责任链模式 (Chain of Responsibility)** 重构代码，使得主流程不需要 `if-else`。
3.  **反射/动态执行**：代码需要根据 JSON 配置，动态加载对应的清洗类或函数。

## 📦 业务场景升级

- **需求变更**：业务方突然要求新增一种清洗规则——“邮箱校验”，且手机号校验规则可能随时变。
- **目标**：在不停止服务、不修改核心代码的情况下，通过修改配置文件或数据库配置，生效新规则。

## 🤖 AI 提效挑战（必做）

### 1. 架构设计（设计模式）

- **挑战**：让 AI 教你重构。
- **Prompt 示例**：
  > "我现在的代码里有很多 `if (type == 'phone') {...} else if (type == 'email') {...}`。请使用**策略模式**帮我重构这段代码。我希望定义一个 `CleaningStrategy` 接口，并根据配置动态选择实现类。"

### 2. 动态解析引擎

- **挑战**：构建一个迷你的规则执行器。
- **Prompt 示例**：
  > "设计一个 JSON 配置格式，用于描述字段的校验规则（支持正则、长度范围、非空）。然后写一个解析器函数，输入这个 JSON 配置和一条数据，自动执行所有校验逻辑。"

## 📅 验收标准

1.  **演示**：在配置文件中修改手机号正则（例如改成允许 8 位数字），不重启服务（或仅重启应用不改代码），再次上传文件，验证新规则是否生效。
2.  **代码审查**：核心清洗逻辑中不能出现针对具体业务的 `if-else`，必须是通用的抽象调用。
